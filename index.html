<!DOCTYPE html>
<html>
<head>
    <title>Calendar Events and Image Generator</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <div id="eventsContainer"></div>
    <button id="generateImageBtn">Generate Image</button>
    <canvas id="resultCanvas" style="border:1px solid #000; display:none;"></canvas>

    <script>
        const API_KEY = 'AIzaSyCbYXSHMp4dkTxF7yGplSLGdck2pQ-oBoU';
        const CALENDAR_ID = '1e819ad725d53549b6693d7df5669332ace8e3c91532ba15e79622443e6521c1@group.calendar.google.com';
        const uploadedImages = [];

        function listUpcomingEvents() {
            gapi.client.init({
                'apiKey': API_KEY,
                'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'],
            }).then(function() {
                return gapi.client.calendar.events.list({
                    'calendarId': CALENDAR_ID,
                    'timeMin': (new Date()).toISOString(),
                    'timeMax': new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                    'singleEvents': true,
                    'orderBy': 'startTime'
                });
            }).then(function(response) {
                const events = response.result.items;
                const eventsContainer = document.getElementById('eventsContainer');
                events.forEach((event, index) => {
                    const start = event.start.dateTime || event.start.date;
                    const eventInfo = document.createElement('div');
                    eventInfo.textContent = `${event.summary} (${start})`;
                    const fileInput = document.createElement('input');
                    fileInput.type = 'file';
                    fileInput.accept = 'image/*';
                    fileInput.onchange = function(e) {
                        handleImageUpload(e, index);
                    };
                    eventsContainer.appendChild(fileInput);
                    eventsContainer.appendChild(eventInfo);
                });
            }, function(reason) {
                console.error('Error: ' + reason.result.error.message);
            });
        }

        function handleImageUpload(e, index) {
            const reader = new FileReader();
            reader.onload = function(event) {
                uploadedImages[index] = new Image();
                uploadedImages[index].src = event.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        }

        document.getElementById('generateImageBtn').addEventListener('click', function() {
            const canvas = document.getElementById('resultCanvas');
            const ctx = canvas.getContext('2d');
            const padding = 20;
            canvas.style.display = 'block';
            canvas.width = 1280; //
            canvas.height = 720; //
            ctx.font = "bold 48px serif";
            //ctx.drawImage(img, padding, currentY, 120, 80)


            let currentY = 0;
            uploadedImages.forEach((img, index) => {
                if (!img) return;
                const eventsContainer = document.getElementById('eventsContainer');
                const eventInfo = eventsContainer.childNodes[index * 2 + 1]; // Get the event info element

                ctx.drawImage(img, padding, currentY, 120, 80); // Draw image
                ctx.fillText(eventInfo.textContent, 120 + padding + padding, currentY + 20); // Draw text next to image

                currentY += 120 + 40;
            });
        });

        gapi.load('client', listUpcomingEvents);
    </script>
</body>
</html>
